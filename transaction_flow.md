# Transaction Flow Diagram

## 1. Complete Transaction Flow
Client Request
↓
API Gateway (FastAPI)
↓
Idempotency Check (Redis) → If duplicate → Return cached response
↓
Fraud Detection Service → Analyze patterns, check rules
↓
Database (SQL) → Store transaction
↓
Send Response to Client


## 2. What Makes a Transaction Unique
- **Transaction ID**: UUID generated by system
- **Idempotency Key**: Client-provided unique key per operation
- **Composite Key**: user_id + amount + timestamp + transaction_type
- **Request Signature**: Hash of request body + timestamp

## 3. Where Fraud Detection Fits
- **Pre-Processing**: Before database write, check:
  - Amount thresholds
  - Frequency limits
  - Geographic patterns
  - Device fingerprinting
- **Post-Processing**: After saving, run:
  - Batch analysis
  - Machine learning models
  - Pattern matching

## 4. What Happens on Duplicate Requests
1. Client sends request with same `Idempotency-Key`
2. System checks Redis cache for the key
3. If found → Returns exact same response (status + body)
4. If not found → Processes normally and caches response
5. No database write occurs for duplicates